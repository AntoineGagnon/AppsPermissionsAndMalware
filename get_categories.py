"""
Created by: 

"""
import math
import sys

from tqdm import tqdm

from main import App

all_apps = App.select().where(App.virus_total_resource.is_null(False)).where(App.category != "Unknown")

categories = {}

for app in tqdm(all_apps):
    try:
        avreport = app.avreport.get()
        percentage = math.ceil(avreport.number_warning / avreport.total_number)
        if(app.category not in categories):
            categories[app.category] = []
            categories[app.category].append(0)
        categories[app.category][0] += 1
        categories[app.category].append(percentage)
    except:
        print("Unexpected error on app {}: {}".format(app.package, sys.exc_info()))

for cat in categories:
    total_apps = categories[cat][0]
    total_risk =sum(categories[cat])
    print("Category : {} Total Risk : {} Total_Apps : {} Percentage : {}".format(cat,total_risk,total_apps,total_risk/total_apps))
