import math

from scipy.stats import stats, spearmanr

from main import *
import scipy

# all_permissiosn = Permission.select()
# perm_data = pandas.read_json("permission_data.json")
#
#
# for perm in tqdm(all_permissiosn):
#     if perm.name in perm_data:
#         perm.description = perm_data[perm.name]["description"]
#         protection_level = perm_data[perm.name]["protectionLevel"]
#         real_protection_level = protection_level
#         if "|" in protection_level:
#             real_protection_level = "signature"
#         if protection_level == "signatureOrSystem":
#             real_protection_level = "signature"
#         perm.protection_level = real_protection_level
#         perm.save()
#

checked_apps = AVReport.select(AVReport.app)

all_apps = App.select().where(App.virus_total_resource.is_null(False)).where(App.id.not_in(checked_apps))

for app in tqdm(all_apps):
    if not app.avreport.exists():
        stats = get_virustotal_data(app.virus_total_resource)
        if stats:
            AVReport.create(app=app, number_warning=stats[0], total_number=stats[1])
