import string
import time

from HomemadeAPI.app_class import Application


def get_app_data(driver, address):
    driver.get(address)
    time.sleep(1)
    name = driver.find_element_by_xpath('//*[@id="fcxH9b"]/div[4]/c-wiz/div/div[2]/div/div[1]/div/c-wiz[1]/c-wiz[1]/div/div[2]/div/div[1]/c-wiz[1]/h1/span').text
    description = driver.find_element_by_xpath('//*[@id="fcxH9b"]/div[4]/c-wiz/div/div[2]/div/div[1]/div/c-wiz[1]/c-wiz[3]/div/div[1]/div[2]/div[1]/content/div').text
    pre_category = driver.find_elements_by_class_name('R8zArc')[1]
    category = pre_category.text
    price = 0
    dirty_rating_value = driver.find_elements_by_class_name('pf5lIe')[0].find_elements_by_tag_name("div")[0].get_attribute("aria-label")
    transtab = str.maketrans('','',string.ascii_letters + string.whitespace)
    rating_value = dirty_rating_value.translate(transtab)
    rating_amount = driver.find_elements_by_class_name('AYi5wd')[0].text
    downloads = driver.find_element_by_xpath('//*[@id="fcxH9b"]/div[4]/c-wiz/div/div[2]/div/div[1]/div/c-wiz[3]/div[1]/div[2]/div/div[3]/span/div/span').text

    elem = driver.find_element_by_xpath("//*[@id=\"fcxH9b\"]/div[4]/c-wiz/div/div[2]/div/div[1]/div/c-wiz[3]/div[1]/div["
                                        "2]/div/c-wiz/div/span/div/span/div/a")
    elem.click()
    time.sleep(1)
    permissions = driver.find_elements_by_class_name("yk0PFc")
    permissions_table = {}

    for element in permissions:
        permission_category = element.find_element_by_class_name("BR7Zgd").text
        permissions_table[permission_category] = []
        for perm in element.find_elements_by_class_name("NLTG4"):
            permissions_table[permission_category].append(perm.text)
    driver.close()

    return Application(name,description,category,price,rating_value,rating_amount,downloads,permissions_table)

